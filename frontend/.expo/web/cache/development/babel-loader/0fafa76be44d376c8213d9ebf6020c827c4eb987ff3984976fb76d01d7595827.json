{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState, useEffect, useContext } from 'react';\nimport { supabase } from \"./supabase\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext();\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    role = _useState4[0],\n    setRole = _useState4[1];\n  var _useState5 = useState(true),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loading = _useState6[0],\n    setLoading = _useState6[1];\n  useEffect(function () {\n    supabase.auth.getSession().then(function (_ref2) {\n      var _session$user;\n      var session = _ref2.data.session;\n      setUser((_session$user = session == null ? void 0 : session.user) != null ? _session$user : null);\n      if (session != null && session.user) fetchRole(session.user.id);else setLoading(false);\n    });\n    var _supabase$auth$onAuth = supabase.auth.onAuthStateChange(function () {\n        var _ref3 = _asyncToGenerator(function* (_event, session) {\n          var _session$user2;\n          setUser((_session$user2 = session == null ? void 0 : session.user) != null ? _session$user2 : null);\n          if (session != null && session.user) {\n            yield fetchRole(session.user.id);\n          } else {\n            setRole(null);\n          }\n          setLoading(false);\n        });\n        return function (_x, _x2) {\n          return _ref3.apply(this, arguments);\n        };\n      }()),\n      subscription = _supabase$auth$onAuth.data.subscription;\n    return function () {\n      return subscription.unsubscribe();\n    };\n  }, []);\n  var fetchRole = function () {\n    var _ref4 = _asyncToGenerator(function* (userId) {\n      try {\n        var _yield$supabase$from$ = yield supabase.from('profiles').select('role').eq('id', userId).single(),\n          data = _yield$supabase$from$.data,\n          error = _yield$supabase$from$.error;\n        if (error && error.code !== 'PGRST116') {\n          console.error('Error fetching role:', error);\n        }\n        setRole((data == null ? void 0 : data.role) || 'user');\n      } catch (e) {\n        console.error(e);\n      }\n    });\n    return function fetchRole(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var signIn = function () {\n    var _ref5 = _asyncToGenerator(function* (email, password) {\n      setLoading(true);\n      var _yield$supabase$auth$ = yield supabase.auth.signInWithPassword({\n          email: email,\n          password: password\n        }),\n        error = _yield$supabase$auth$.error;\n      if (error) Alert.alert('Login Failed', error.message);\n      setLoading(false);\n    });\n    return function signIn(_x4, _x5) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var signUp = function () {\n    var _ref6 = _asyncToGenerator(function* (email, password) {\n      setLoading(true);\n      var _yield$supabase$auth$2 = yield supabase.auth.signUp({\n          email: email,\n          password: password\n        }),\n        error = _yield$supabase$auth$2.error;\n      if (error) Alert.alert('Registration Failed', error.message);else Alert.alert('Success', 'Check your email for verification!');\n      setLoading(false);\n    });\n    return function signUp(_x6, _x7) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var signOut = function () {\n    var _ref7 = _asyncToGenerator(function* () {\n      setLoading(true);\n      yield supabase.auth.signOut();\n      setLoading(false);\n    });\n    return function signOut() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      role: role,\n      loading: loading,\n      signIn: signIn,\n      signUp: signUp,\n      signOut: signOut\n    },\n    children: children\n  });\n};\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","supabase","Alert","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","role","setRole","_useState5","_useState6","loading","setLoading","auth","getSession","then","_ref2","_session$user","session","data","fetchRole","id","_supabase$auth$onAuth","onAuthStateChange","_ref3","_asyncToGenerator","_event","_session$user2","_x","_x2","apply","arguments","subscription","unsubscribe","_ref4","userId","_yield$supabase$from$","from","select","eq","single","error","code","console","e","_x3","signIn","_ref5","email","password","_yield$supabase$auth$","signInWithPassword","alert","message","_x4","_x5","signUp","_ref6","_yield$supabase$auth$2","_x6","_x7","signOut","_ref7","Provider","value","useAuth"],"sources":["C:/Users/avibh/OneDrive/Desktop/HR RoadWays/frontend/utils/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from 'react';\r\nimport { supabase } from './supabase';\r\nimport { Alert } from 'react-native';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [role, setRole] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Check active session\r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setUser(session?.user ?? null);\r\n      if (session?.user) fetchRole(session.user.id);\r\n      else setLoading(false);\r\n    });\r\n\r\n    // Listen for auth changes\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (_event, session) => {\r\n      setUser(session?.user ?? null);\r\n      if (session?.user) {\r\n        await fetchRole(session.user.id);\r\n      } else {\r\n        setRole(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  const fetchRole = async (userId) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('role')\r\n        .eq('id', userId)\r\n        .single();\r\n      \r\n      if (error && error.code !== 'PGRST116') {\r\n         console.error('Error fetching role:', error);\r\n      }\r\n      \r\n      setRole(data?.role || 'user');\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  const signIn = async (email, password) => {\r\n    setLoading(true);\r\n    const { error } = await supabase.auth.signInWithPassword({ email, password });\r\n    if (error) Alert.alert('Login Failed', error.message);\r\n    setLoading(false);\r\n  };\r\n\r\n  const signUp = async (email, password) => {\r\n    setLoading(true);\r\n    const { error } = await supabase.auth.signUp({ email, password });\r\n    if (error) Alert.alert('Registration Failed', error.message);\r\n    else Alert.alert('Success', 'Check your email for verification!');\r\n    setLoading(false);\r\n  };\r\n\r\n  const signOut = async () => {\r\n    setLoading(true);\r\n    await supabase.auth.signOut();\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, role, loading, signIn, signUp, signOut }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}