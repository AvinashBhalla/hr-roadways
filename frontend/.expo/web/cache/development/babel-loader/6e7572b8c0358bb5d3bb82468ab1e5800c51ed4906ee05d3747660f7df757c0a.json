{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Switch from \"react-native-web/dist/exports/Switch\";\nimport BusCard from \"../components/BusCard\";\nimport mockData from \"../data/mockData.json\";\nimport * as Location from 'expo-location';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function BusListScreen(_ref) {\n  var navigation = _ref.navigation;\n  var _useState = useState(mockData.buses),\n    _useState2 = _slicedToArray(_useState, 2),\n    buses = _useState2[0],\n    setBuses = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    userLoc = _useState4[0],\n    setUserLoc = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    consent = _useState6[0],\n    setConsent = _useState6[1];\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var _yield$Location$reque = yield Location.requestForegroundPermissionsAsync(),\n        status = _yield$Location$reque.status;\n      if (status === 'granted') {\n        var location = yield Location.getCurrentPositionAsync({});\n        setUserLoc(location.coords);\n        checkMismatch(location.coords);\n      }\n    })();\n  }, []);\n  var checkMismatch = function checkMismatch(coords) {\n    var pickup = {\n      lat: 29.6857,\n      lng: 76.9905\n    };\n    var dist = getDist(coords.latitude, coords.longitude, pickup.lat, pickup.lng);\n    if (dist > 300) {\n      Alert.alert(\"Location Mismatch\", \"You are far from pickup point! Catch next bus?\", [{\n        text: \"Cancel\",\n        style: \"cancel\"\n      }, {\n        text: \"Show Alternates\",\n        onPress: function onPress() {\n          return console.log(\"Fetch alternates...\");\n        }\n      }]);\n    }\n  };\n  var getDist = function getDist(lat1, lon1, lat2, lon2) {\n    return Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lon2 - lon1, 2)) * 111000;\n  };\n  return _jsxs(View, {\n    style: {\n      flex: 1,\n      padding: 10\n    },\n    children: [_jsxs(View, {\n      style: {\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        marginBottom: 10\n      },\n      children: [_jsx(Text, {\n        children: \"Share Loc for Tracking?\"\n      }), _jsx(Switch, {\n        value: consent,\n        onValueChange: setConsent\n      })]\n    }), _jsx(FlatList, {\n      data: buses,\n      keyExtractor: function keyExtractor(item) {\n        return item.bus_id;\n      },\n      renderItem: function renderItem(_ref3) {\n        var item = _ref3.item;\n        return _jsx(BusCard, {\n          bus: item,\n          isDerived: item.is_derived_demo,\n          onPress: function onPress() {\n            return navigation.navigate('Ticket', {\n              bus: item\n            });\n          }\n        });\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","useState","useEffect","View","FlatList","Alert","Text","Switch","BusCard","mockData","Location","jsx","_jsx","jsxs","_jsxs","BusListScreen","_ref","navigation","_useState","buses","_useState2","_slicedToArray","setBuses","_useState3","_useState4","userLoc","setUserLoc","_useState5","_useState6","consent","setConsent","_asyncToGenerator","_yield$Location$reque","requestForegroundPermissionsAsync","status","location","getCurrentPositionAsync","coords","checkMismatch","pickup","lat","lng","dist","getDist","latitude","longitude","alert","text","style","onPress","console","log","lat1","lon1","lat2","lon2","Math","sqrt","pow","flex","padding","children","flexDirection","justifyContent","marginBottom","value","onValueChange","data","keyExtractor","item","bus_id","renderItem","_ref3","bus","isDerived","is_derived_demo","navigate"],"sources":["C:/Users/avibh/OneDrive/Desktop/HR RoadWays/frontend/screens/BusListScreen.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { View, FlatList, Alert, Text, Switch } from 'react-native';\r\nimport BusCard from '../components/BusCard';\r\nimport mockData from '../data/mockData.json';\r\nimport * as Location from 'expo-location';\r\n\r\nexport default function BusListScreen({ navigation }) {\r\n  const [buses, setBuses] = useState(mockData.buses);\r\n  const [userLoc, setUserLoc] = useState(null);\r\n  const [consent, setConsent] = useState(false);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      let { status } = await Location.requestForegroundPermissionsAsync();\r\n      if (status === 'granted') {\r\n        let location = await Location.getCurrentPositionAsync({});\r\n        setUserLoc(location.coords);\r\n        checkMismatch(location.coords);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // Mismatch Alert Logic (User far from pickup)\r\n  const checkMismatch = (coords) => {\r\n    // Mock pickup loc (Karnal Stand)\r\n    const pickup = { lat: 29.6857, lng: 76.9905 };\r\n    const dist = getDist(coords.latitude, coords.longitude, pickup.lat, pickup.lng);\r\n    \r\n    // > 300m\r\n    if (dist > 300) {\r\n      Alert.alert(\r\n        \"Location Mismatch\",\r\n        \"You are far from pickup point! Catch next bus?\",\r\n        [\r\n          { text: \"Cancel\", style: \"cancel\" },\r\n          { text: \"Show Alternates\", onPress: () => console.log(\"Fetch alternates...\") }\r\n        ]\r\n      );\r\n    }\r\n  };\r\n\r\n  const getDist = (lat1, lon1, lat2, lon2) => {\r\n    // simplified distance check\r\n    return Math.sqrt(Math.pow(lat2-lat1, 2) + Math.pow(lon2-lon1, 2)) * 111000;\r\n  };\r\n\r\n  return (\r\n    <View style={{ flex: 1, padding: 10 }}>\r\n     <View style={{flexDirection:'row', justifyContent:'space-between', marginBottom:10}}>\r\n       <Text>Share Loc for Tracking?</Text>\r\n       <Switch value={consent} onValueChange={setConsent} />\r\n     </View>\r\n      <FlatList\r\n        data={buses}\r\n        keyExtractor={item => item.bus_id}\r\n        renderItem={({ item }) => (\r\n          <BusCard \r\n            bus={item} \r\n            isDerived={item.is_derived_demo} // Flag to test UI\r\n            onPress={() => navigation.navigate('Ticket', { bus: item })}\r\n          />\r\n        )}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}